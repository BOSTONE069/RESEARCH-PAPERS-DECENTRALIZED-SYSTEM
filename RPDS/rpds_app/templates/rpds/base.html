{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>RPDS</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="{% static 'assets/favicon.ico' %}"
    />
    <!-- Font Awesome icons (free version)-->
    <script
      src="https://use.fontawesome.com/releases/v6.3.0/js/all.js"
      crossorigin="anonymous"
    ></script>
    <!-- Google fonts-->
    <link
      href="https://fonts.googleapis.com/css?family=Varela+Round"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
      rel="stylesheet"
    />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="{% static 'css/styles.css' %}" rel="stylesheet" />
  </head>
  <body id="page-top">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
      <div class="container px-4 px-lg-5">
        <a class="navbar-brand" href="#page-top"
          >RESEARCH PAPERS DECENTRALIZED SYSTEM</a
        >
        <button
          class="navbar-toggler navbar-toggler-right"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarResponsive"
          aria-controls="navbarResponsive"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          Menu
          <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="{% url  'home' %}">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url  'about'%}">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'login'%}">RPDS PAPERS</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'contact'%}">Contact</a>
            </li>
            <li class="nav-item">
              <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <a
                  class="btn btn-primary btn-sm rounded-pill me-md-2 mt-3"
                  id="connectWallet"
                  onclick="connectWalletwithMetaMask(); checkBalance();"
                  role="button"
                  >Connect</a
                >
                <p
                  style="margin-top: 40px; color: white; font-size: 20px"
                  id="walletAddress"
                ></p>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Masthead-->
    {% block body %} {% endblock %}

    <!-- Footer-->
    <footer class="footer bg-black small text-center text-white-50">
      <div class="container px-4 px-lg-5">
        Copyright &copy; RPDS
        <script>
          document.write(new Date().getFullYear());
        </script>
      </div>
    </footer>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="{% static 'js/scripts.js' %}"></script>
    <script type="text/javascript">
      window.userWalletAddress = null;
      const connectWallet = document.getElementById("connectWallet");
      const walletAddress = document.getElementById("walletAddress");
      const walletBalance = document.getElementById("walletBalance");

      function checkInstalled() {
        if (typeof window.ethereum == "undefined") {
          connectWallet.innerText =
            "MetaMask isn't installed, please install it";
          connectWallet.classList.remove();
          connectWallet.classList.add();
          return false;
        }
        connectWallet.addEventListener("click", connectWalletwithMetaMask);
      }

      async function connectWalletwithMetaMask() {
        const accounts = await window.ethereum
          .request({ method: "eth_requestAccounts" })
          .catch((e) => {
            console.error(e.message);
            return;
          });

        if (!accounts) {
          return;
        }

        window.userWalletAddress = accounts[0];
        walletAddress.innerText = window.userWalletAddress;

        connectWallet.innerText = "Sign Out";
        connectWallet.removeEventListener("click", connectWalletwithMetaMask);
        setTimeout(() => {
          connectWallet.addEventListener("click", signOutOfMetaMask);
        }, 200);
      }

      function signOutOfMetaMask() {
        window.userWalletAddress = null;
        walletAddress.innerText = "";
        connectWallet.innerText = "Connect Wallet";

        connectWallet.removeEventListener("click", signOutOfMetaMask);
        setTimeout(() => {
          connectWallet.addEventListener("click", connectWalletwithMetaMask);
        }, 200);
      }

      async function checkBalance() {
        let balance = await window.ethereum.request({
            method: "eth_getBalance",
            params: [window.userWalletAddress,
            "latest"],
          }).catch((err) => {
            console.log(err);
          });

        walletBalance.innerText = 'Balance in Eth: '  + parseFloat(balance) / Math.pow(10, 18);
      }

      window.addEventListener("DOMContentLoaded", () => {
        checkInstalled();
      });
    </script>
  </body>
</html>
{% comment %}
<div style="margin-top: 200px; background-color: grey; background-size: cover">
  <center>
    <h1>Connect Your MetaMask Wallet Here!</h1>
    <button id="connectWallet" onclick="connectWalletwithMetaMask()">
      Connect Wallet
    </button>
    <button id="getBalance" onclick="checkBalance()">
      Get Balance of Wallet
    </button>

    <p id="walletAddress"></p>
    <p id="walletBalance"></p>

    <script type="text/javascript">
      window.userWalletAddress = null;
      const connectWallet = document.getElementById("connectWallet");
      const walletAddress = document.getElementById("walletAddress");
      const walletBalance = document.getElementById("walletBalance");

      function checkInstalled() {
        if (typeof window.ethereum == "undefined") {
          connectWallet.innerText =
            "MetaMask isn't installed, please install it";
          connectWallet.classList.remove();
          connectWallet.classList.add();
          return false;
        }
        connectWallet.addEventListener("click", connectWalletwithMetaMask);
      }

      async function connectWalletwithMetaMask() {
        const accounts = await window.ethereum
          .request({ method: "eth_requestAccounts" })
          .catch((e) => {
            console.error(e.message);
            return;
          });

        if (!accounts) {
          return;
        }

        window.userWalletAddress = accounts[0];
        walletAddress.innerText = window.userWalletAddress;

        connectWallet.innerText = "Sign Out";
        connectWallet.removeEventListener("click", connectWalletwithMetaMask);
        setTimeout(() => {
          connectWallet.addEventListener("click", signOutOfMetaMask);
        }, 200);
      }

      function signOutOfMetaMask() {
        window.userwalletAddress = null;
        walletAddress.innerText = "";
        connectWallet.innerText = "Connect Wallet";

        connectWallet.removeEventListener("click", signOutOfMetaMask);
        setTimeout(() => {
          connectWallet.addEventListener("click", connectWalletwithMetaMask);
        }, 200);
      }

      async function checkBalance() {
        let balance = await window.ethereum
          .request({
            method: "eth_getBalance",
            params: [window.userWalletAddress, "latest"],
          })
          .catch((err) => {
            console.log(err);
          });

        console.log(parseFloat(balance) / Math.pow(10, 18));

        walletBalance.innerText = parseFloat(balance) / Math.pow(10, 18);
      }

      window.addEventListener("DOMContentLoaded", () => {
        checkInstalled();
      });
    </script>
  </center>
</div>
{% endcomment %}
